@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Input Data</h4>
            </div>
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-group row">
                        <input type="hidden" id="liburId" />
                        <label class="col-sm-3 control-label">Hari</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="hari" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 control-label">Tanggal</label>
                        <div class="col-sm-6">
                            <input type="date" class="form-control datepicker" id="tanggal" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 control-label">Keterangan</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="keterangan" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="Save" onclick="Validation();">Simpan</button>
                <button type="button" class="btn btn-primary" id="Update" onclick="Validation();">Perbarui</button>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container">
        <div class="card" style="background-color:white">
            <div class="card-header card-header-info">
                <h3 class="card-title badge text-light font-weight-bolder" style="background-color:#319DA0">Hari Libur</h3>
                <a class="btn btn-sm btn-danger float-right ml-2" onclick="DeleteAll()">Hapus <i class="fas fa-trash"></i></a>
                <a class="btn btn-sm btn-success float-right" data-toggle="modal" data-target="#myModal" onclick="ClearScreen()" data-backdrop="static" data-keyboard="false" ;>Tambah Data <i class="fas fa-plus-circle"></i></a>
            </div>
            <div class="card-body ">
                <table id="table" data-transid="1" class="table table-bordered">
                    <thead style="background-color:#319DA0">
                        <tr>
                            <th><input type="checkbox" id="allcb" /></th>
                            <th>No</th>
                            <th>Hari</th>
                            <th>Tanggal</th>
                            <th>Keterangan</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function() {
        read();
        $("input#allcb").click(function() {
            let all = this.cheked;
            if (this.checked) {
                $('.cb').each(function() {
                    let item = this.checked;
                    if (all !== item) {
                        this.checked = true;
                    }
                });
            } else {
                $(".cb").each(function() {
                    this.checked = false;
                })
            }
        });
    })

    function read() {
        var t = $("#table").DataTable({
            "ajax": {
                "url": "@Url.Action("Get","Libur")",
                "type": "GET",
                "datatype": "json",
            },
            "columns": [
                {
                    render: (data, type, row) => `<input data-id="${row.id}" type="checkbox" class="cb" />`
                },
                {
                    render: (data, type, row, meta) => meta.row + meta.settings._iDisplayStart + 1
                },
                { "data": "hari" },
                {
                    render: (data, type, row, meta) => {
                        return moment(row.tanggalLibur).format('MMMM Do YYYY');
                    }
                },
                { "data": "keterangan" },
                {
                    "render": function(data, type, row) {
                        return "<button class ='btn btn-danger btn-sm text-white' onclick = Delete('" + row.id + "');><i class='fas fa-trash'></i></button>";
                    },
                },
            ],
            columnDefs: [{
                orderable: false,
                className: "",
                targets: 0

            }],
            'select': {
                'style': 'multi'
            },
            order: [[1, 'asc']]
        })
    }

    function Save() {
        console.log(data);
        debugger;
        var data = new Object();
        data.Id = $("#liburId").val();
        data.Hari = $("#hari").val();
        data.TanggalLibur = $("#tanggal").val();
        data.Keterangan = $("#keterangan").val();
        $.ajax({
            "url": "@Url.Action("Save","Libur")",
            "type": "POST",
            "datatype": "json",
            "data": data
        }).then((result) => {
            if (result != false) {
                Swal.fire(
                    'Success!',
                    'Data Berhasil Diinput!.',
                    'success'
                ).then(() => {
                    $("#myModal").modal('hide');
                    $('#table').DataTable().ajax.reload();
                })
            }
            else {
                Swal.fire(
                    'Failed!',
                    'Data Tidak Berhasil Diinput!.',
                    'Failed'
                ).then(() => {
                    $("#myModal").modal('hide');
                    $('#table').DataTable().ajax.reload();
                })
            }
        })
    }
    function Delete(Id) {
        Swal.fire({
            title: 'Apakah Anda Yakin?',
            text: "Data Terhapus Tidak Bisa Dikembalikan!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    "url": "@Url.Action("Delete","Libur")",
                    "datatype": "json",
                    "data": { Id: Id }
                }).then((result) => {
                    debugger;
                    if (result.data != 0) {
                        Swal.fire(
                            'Success!',
                            'Data Terhapus.',
                            'success'
                        ).then(() => {
                            $('#table').DataTable().ajax.reload();
                        })
                    }
                    else {
                        Swal.fire(
                            'Failed!',
                            'Data Tidak Terhapus.',
                            'failed'
                        ).then(() => {
                            $('#table').DataTable().ajax.reload();
                        })
                    }
                    $("#myModal").modal('hide');
                    $('#table_role').DataTable().ajax.reload();
                })
            }
        })
    }
    function DeleteAll() {
        debugger;
        const checkboxChecked = $(`table[data-transid='1'] input.cb:checked`);
    //console.log(checkboxChecked);
        const idsCek = [];
        $.each(checkboxChecked, function(idx, val) {
            console.log(val)
            idsCek.push($(val).data("id"))

        });
    var senddata = {
        Id: idsCek, 
    };
        
     Swal.fire({
            title: "Yakin ingin menghapus semuanya?",
            showDenyButton: true,
            confirmButtonText: "Ya",
            denyButtonText: "Tidak",
            icon: "warning",
        }).then(result => {
        if (result.isConfirmed) 
        {
            $.ajax({
                url:"@Url.Action("DeleteAll","Libur")",
                type:"POST",
                data: senddata,
                dataType:"json",
                success:function(data,textStatus,xhr){
                    console.log(data);
                    if (data) {
                        Swal.fire({
                            icon: 'success',
                            title: "Berhasil",
                            text: "Berhasil Hapus",
                            showConfirmButton: true,
                        }).then(function (){

                        location.reload(true);
                        });
                    } else {
                        Swal.fire({
                        icon:"error",
                        title:"Error",
                        text:"Gagal send Approve"
                    });
                    }
                },
            });       
        }
        
            
             
    });

        
}

    function ClearScreen() {
        $("#liburId").val('');
        $("#hari").val('');
        $("#tanggal").val('');
        $("#keterangan").val('');
        $("#Update").hide();
        $("#Save").show();
    }
    function Validation() {
        if ($("#tanggal").val() == "" || $("#tanggal").val() == " ") {
            Swal.fire('mohon isi field nama bank');
        }
        else if ($("#liburId").val() == "" || $("#liburId").val() == " ") {
            Save();
        }
        else {
            Edit($("#liburId").val());
        }
    }


                                            //$(document).ready(function() {
                                            //    var table = $('#table').DataTable({
                                            //        'columnDefs': [
                                            //            {
                                            //                'targets': 0,
                                            //                'checkboxes': {
                                            //                    'selectRow'= true
                                            //                }
                                            //            }
                                            //        ],
                                            //        'select': {
                                            //            'style': 'multi'
                                            //        },
                                            //        'order':[[1, 'asc']]
                                            //    })
                                            //})
</script>